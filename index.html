<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard Financeiro - SSA Produções</title>

  <style>
    * { box-sizing: border-box; }
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      margin: 0; 
      padding: 0; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    
    header { 
      background: rgba(255,255,255,0.1); 
      backdrop-filter: blur(10px);
      color: white; 
      padding: 20px; 
      text-align: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .container { max-width: 1200px; margin: auto; padding: 20px; }
    .cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 25px 0; }
    .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); border-left: 5px solid #667eea; }
    .card h3 { margin: 0 0 10px 0; font-size: 16px; text-transform: uppercase; letter-spacing: 1px; color: #333; }
    .card p { margin: 0; font-size: 22px; font-weight: bold; }
    .positive { color: #27ae60; } .negative { color: #e74c3c; }

    .filters-section { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); margin-bottom: 25px; display: flex; gap: 15px; flex-wrap: wrap; align-items: center; }
    select { padding: 10px; border: 2px solid #ddd; border-radius: 8px; min-width: 200px; }
    select:focus { outline: none; border-color: #667eea; }

    .tabs-section { background: white; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); overflow: hidden; }
    #tabs { display: flex; background: #f8f9fa; }
    #tabs button { flex: 1; padding: 15px; border: none; background: transparent; cursor: pointer; font-weight: bold; }
    #tabs button.active { background: #667eea; color: white; }

    table { width: 100%; border-collapse: collapse; background: white; }
    th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: left; }
    th { background: #f8f9fa; text-transform: uppercase; font-size: 13px; }
    tr:hover { background: #f8f9fa; }

    .tab-content { display: none; padding: 25px; }
    .tab-content.active { display: block; }

    .status-indicator { display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-right: 6px; }
    .status-success { background: #27ae60; }
    .status-error { background: #e74c3c; }
  </style>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body>
  <header>
    <h1>📊 Dashboard Financeiro - SSA Produções</h1>
    <p>Dados consolidados de todos os eventos</p>
  </header>

  <div class="container">
    <!-- Resumo -->
    <div class="cards">
      <div class="card"><h3>💰 Receita Total</h3><p id="totalRevenue">R$ 0,00</p></div>
      <div class="card"><h3>💸 Despesa Total</h3><p id="totalExpense">R$ 0,00</p></div>
      <div class="card"><h3>📈 Resultado Líquido</h3><p id="netResult">R$ 0,00</p></div>
      <div class="card"><h3>📊 Margem Líquida</h3><p id="netMargin">0%</p></div>
    </div>

    <!-- Filtros -->
    <div class="filters-section">
      <label for="eventFilter"><strong>🎯 Evento:</strong></label>
      <select id="eventFilter" onchange="filterData()"><option value="all">Todos</option></select>
    </div>

    <!-- Abas -->
    <div class="tabs-section">
      <div id="tabs">
        <button class="active" onclick="showTab('overview', this)">📋 Visão Geral</button>
        <button onclick="showTab('compare', this)">⚖️ Comparar</button>
        <button onclick="showTab('analysis', this)">📈 Análises</button>
      </div>

      <!-- Visão Geral -->
      <div id="overview" class="tab-content active">
        <table id="eventsTable">
          <thead>
            <tr><th>Evento</th><th>Receita</th><th>Despesa</th><th>Resultado</th><th>Margem</th><th>Status</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- Comparação -->
      <div id="compare" class="tab-content">
        <h3>Selecione eventos para comparar:</h3>
        <select id="compareSelect" multiple size="8"></select>
        <button onclick="compareEvents()">📊 Comparar</button>
        <div id="compareContainer"></div>
      </div>

      <!-- Análises -->
      <div id="analysis" class="tab-content">
        <div class="cards">
          <div class="card"><h3>🏆 Melhor Evento</h3><p id="bestEvent">-</p></div>
          <div class="card"><h3>📉 Pior Evento</h3><p id="worstEvent">-</p></div>
          <div class="card"><h3>🎯 Média de Margem</h3><p id="avgMargin">0%</p></div>
          <div class="card"><h3>📊 Total de Eventos</h3><p id="totalEvents">0</p></div>
        </div>
        <canvas id="revenueChart" height="200"></canvas>
      </div>
    </div>
  </div>

  <script>
    let eventsData = [];
    let filteredData = [];
    let revenueChart = null;

    // Carregar JSON consolidado
    fetch("eventos_consolidado_for_dashboard.json")
      .then(res => res.json())
      .then(data => {
        eventsData = data;
        updateAllData();
      })
      .catch(err => console.error("Erro ao carregar JSON:", err));

    function formatCurrency(value) {
      return value.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
    }

    function updateAllData() {
      filterData();
      updateEventFilter();
      updateCompareSelect();
      updateAnalysis();
      updateChart();
    }

    function updateSummary() {
      const totalRevenue = filteredData.reduce((s, e) => s + e.revenue, 0);
      const totalExpense = filteredData.reduce((s, e) => s + e.expense, 0);
      const netResult = totalRevenue - totalExpense;
      const netMargin = totalRevenue > 0 ? (netResult / totalRevenue) * 100 : 0;

      document.getElementById("totalRevenue").textContent = formatCurrency(totalRevenue);
      document.getElementById("totalExpense").textContent = formatCurrency(totalExpense);
      document.getElementById("netResult").textContent = formatCurrency(netResult);
      document.getElementById("netResult").className = netResult >= 0 ? "positive" : "negative";
      document.getElementById("netMargin").textContent = netMargin.toFixed(2) + "%";
    }

    function updateOverviewTable() {
      const tbody = document.querySelector("#eventsTable tbody");
      tbody.innerHTML = "";
      filteredData.forEach(e => {
        const margin = e.revenue > 0 ? (e.result / e.revenue) * 100 : 0;
        tbody.innerHTML += `
          <tr>
            <td><strong>${e.name}</strong></td>
            <td>${formatCurrency(e.revenue)}</td>
            <td>${formatCurrency(e.expense)}</td>
            <td class="${e.result >= 0 ? "positive" : "negative"}">${formatCurrency(e.result)}</td>
            <td>${margin.toFixed(2)}%</td>
            <td><span class="status-indicator ${e.result >= 0 ? "status-success" : "status-error"}"></span>${e.result >= 0 ? "Lucro" : "Prejuízo"}</td>
          </tr>`;
      });
    }

    function updateEventFilter() {
      const filter = document.getElementById("eventFilter");
      filter.innerHTML = '<option value="all">Todos</option>';
      [...new Set(eventsData.map(e => e.name))].forEach(name => {
        const opt = document.createElement("option");
        opt.value = name;
        opt.textContent = name;
        filter.appendChild(opt);
      });
    }

    function updateCompareSelect() {
      const select = document.getElementById("compareSelect");
      select.innerHTML = "";
      eventsData.forEach(e => {
        const opt = document.createElement("option");
        opt.value = e.name;
        opt.textContent = `${e.name} (${formatCurrency(e.result)})`;
        select.appendChild(opt);
      });
    }

    function updateAnalysis() {
      if (eventsData.length === 0) return;
      const sorted = [...eventsData].sort((a,b) => b.result - a.result);
      const best = sorted[0], worst = sorted[sorted.length-1];
      const avgMargin = eventsData.reduce((s,e)=> s + (e.revenue>0?(e.result/e.revenue*100):0),0)/eventsData.length;

      document.getElementById("bestEvent").textContent = `${best.name} (${formatCurrency(best.result)})`;
      document.getElementById("worstEvent").textContent = `${worst.name} (${formatCurrency(worst.result)})`;
      document.getElementById("avgMargin").textContent = avgMargin.toFixed(2)+"%";
      document.getElementById("totalEvents").textContent = eventsData.length;
    }

    function updateChart() {
      if (!document.getElementById("revenueChart")) return;
      const ctx = document.getElementById("revenueChart").getContext("2d");
      if (revenueChart) revenueChart.destroy();
      revenueChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: eventsData.map(e => e.name),
          datasets: [
            { label: "Receita", data: eventsData.map(e => e.revenue), backgroundColor: "rgba(102,126,234,0.7)" },
            { label: "Despesa", data: eventsData.map(e => e.expense), backgroundColor: "rgba(231,76,60,0.7)" }
          ]
        },
        options: { responsive: true, plugins: { legend: { position: 'top' } } }
      });
    }

    function filterData() {
      const eventFilter = document.getElementById("eventFilter").value;
      filteredData = eventFilter === "all" ? eventsData : eventsData.filter(e => e.name === eventFilter);
      updateSummary();
      updateOverviewTable();
    }

    function compareEvents() {
      const selected = [...document.getElementById("compareSelect").selectedOptions].map(o => o.value);
      const compareData = eventsData.filter(e => selected.includes(e.name));
      let html = "<table><tr><th>Evento</th><th>Receita</th><th>Despesa</th><th>Resultado</th><th>Margem</th></tr>";
      compareData.forEach(e => {
        const margin = e.revenue > 0 ? (e.result / e.revenue) * 100 : 0;
        html += `<tr>
          <td>${e.name}</td>
          <td>${formatCurrency(e.revenue)}</td>
          <td>${formatCurrency(e.expense)}</td>
          <td>${formatCurrency(e.result)}</td>
          <td>${margin.toFixed(2)}%</td>
        </tr>`;
      });
      html += "</table>";
      document.getElementById("compareContainer").innerHTML = html;
    }

    function showTab(id, btn) {
      document.querySelectorAll(".tab-content").forEach(t => t.classList.remove("active"));
      document.getElementById(id).classList.add("active");
      document.querySelectorAll("#tabs button").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
    }
  </script>
</body>
</html>
