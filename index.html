<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard Financeiro - SSA ProduÃ§Ãµes</title>

  <style>
    /* --- Mantive os estilos do modelo que vocÃª gostou --- */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
    }
    header {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      padding: 20px;
      text-align: center;
      color: white;
    }
    .container { max-width: 1200px; margin: auto; padding: 20px; }
    .cards { display: grid; grid-template-columns: repeat(auto-fit,minmax(250px,1fr)); gap: 20px; margin: 25px 0; }
    .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    .positive { color: #27ae60; }
    .negative { color: #e74c3c; }
    table { width: 100%; border-collapse: collapse; background: white; margin-top: 20px; }
    th, td { padding: 12px; border-bottom: 1px solid #ddd; text-align: left; }
    th { background: #f8f9fa; }
    tr:hover { background: #f4f4f4; }
  </style>

  <!-- Chart.js para grÃ¡ficos -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body>
  <header>
    <h1>ðŸ“Š Dashboard Financeiro - SSA ProduÃ§Ãµes</h1>
    <p>Os dados abaixo vÃªm do arquivo consolidado JSON</p>
  </header>

  <div class="container">
    <!-- Cards resumo -->
    <div class="cards">
      <div class="card"><h3>Receita Total</h3><p id="totalRevenue">R$ 0,00</p></div>
      <div class="card"><h3>Despesa Total</h3><p id="totalExpense">R$ 0,00</p></div>
      <div class="card"><h3>Resultado LÃ­quido</h3><p id="netResult">R$ 0,00</p></div>
      <div class="card"><h3>Margem LÃ­quida</h3><p id="netMargin">0%</p></div>
    </div>

    <!-- Tabela de eventos -->
    <table id="eventsTable">
      <thead>
        <tr>
          <th>Evento</th>
          <th>Tipo</th>
          <th>Receita</th>
          <th>Despesa</th>
          <th>Resultado</th>
          <th>Margem</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <!-- GrÃ¡fico -->
    <canvas id="revenueChart" height="120"></canvas>
  </div>

  <script>
    let eventsData = [];
    let revenueChart = null;

    // ðŸ”¹ Carregar JSON consolidado automaticamente
    fetch("eventos_consolidado_for_dashboard.json")
      .then(res => res.json())
      .then(data => {
        eventsData = data.map(e => ({
          name: e.evento,
          type: e.tipo || "NÃ£o informado",
          revenue: Number(e.receita || 0),
          expense: Number(e.despesa || 0),
          result: Number(e.resultado || (e.receita - e.despesa) || 0)
        }));
        updateDashboard();
      })
      .catch(err => console.error("Erro ao carregar JSON:", err));

    function formatCurrency(value) {
      return value.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
    }

    function updateDashboard() {
      // Totais
      const totalRevenue = eventsData.reduce((s,e)=>s+e.revenue,0);
      const totalExpense = eventsData.reduce((s,e)=>s+e.expense,0);
      const netResult = totalRevenue - totalExpense;
      const netMargin = totalRevenue>0?(netResult/totalRevenue)*100:0;

      document.getElementById("totalRevenue").textContent = formatCurrency(totalRevenue);
      document.getElementById("totalExpense").textContent = formatCurrency(totalExpense);
      document.getElementById("netResult").textContent = formatCurrency(netResult);
      document.getElementById("netResult").className = netResult>=0?"positive":"negative";
      document.getElementById("netMargin").textContent = netMargin.toFixed(2)+"%";

      // Tabela
      const tbody = document.querySelector("#eventsTable tbody");
      tbody.innerHTML = "";
      eventsData.forEach(e=>{
        const margin = e.revenue>0?(e.result/e.revenue)*100:0;
        tbody.innerHTML += `
          <tr>
            <td>${e.name}</td>
            <td>${e.type}</td>
            <td>${formatCurrency(e.revenue)}</td>
            <td>${formatCurrency(e.expense)}</td>
            <td class="${e.result>=0?"positive":"negative"}">${formatCurrency(e.result)}</td>
            <td>${margin.toFixed(2)}%</td>
          </tr>`;
      });

      // GrÃ¡fico
      const ctx = document.getElementById("revenueChart").getContext("2d");
      if (revenueChart) revenueChart.destroy();
      revenueChart = new Chart(ctx, {
        type: "bar",
        data: {
          labels: eventsData.map(e=>e.name),
          datasets: [
            { label:"Receita", data: eventsData.map(e=>e.revenue), backgroundColor:"rgba(102,126,234,0.7)" },
            { label:"Despesa", data: eventsData.map(e=>e.expense), backgroundColor:"rgba(231,76,60,0.7)" }
          ]
        },
        options: { responsive:true, plugins:{ title:{ display:true, text:"Receitas vs Despesas por Evento" } } }
      });
    }
  </script>
</body>
</html>
